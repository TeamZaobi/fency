# 凿壁项目代码结构指南

> 本文档基于代码审计结果，提供了凿壁项目的代码结构指南和最佳实践。

## 1. 代码组织与模块化

### 1.1 组件大小控制

- **规则**: 单个组件文件不应超过150行代码
- **理由**: 分析显示超过150行的组件文件复杂度显著增加，更难维护
- **执行方式**: 使用ESLint规则配置`max-lines`，在CI流程中验证
- **优先级**: 高

### 1.2 模块内聚度原则

- **规则**: 每个模块应该有明确的单一职责，内聚度分数应大于0.6
- **理由**: 低内聚模块（如`utils/helpers.js`）造成依赖混乱和维护困难
- **执行方式**: 通过代码审查和AST分析工具检测
- **例外**: 特定的工具类可以有较低内聚度，但需明确文档说明

### 1.3 目录结构规范

- **规则**: 采用特性优先的目录结构组织，不按技术类型分类
- **理由**: 图分析显示特性优先组织的代码库模块间依赖更清晰
- **示例**:
  ```
  /feature-name/
    /components/
    /hooks/
    /utils/
    /tests/
  ```
  而非:
  ```
  /components/
  /hooks/
  /utils/
  /tests/
  ```

## 2. 元数据管理

### 2.1 统一元数据访问

- **规则**: 创建统一的元数据访问层，集中管理元数据读取和解析逻辑
- **理由**: 审计发现元数据结构变更需要修改多个文件，部分页面使用硬编码元数据而非中央存储
- **实施方案**: 开发统一的元数据访问 API，集中管理元数据读取和解析逻辑

### 2.2 元数据格式标准化

- **规则**: 所有页面元数据必须遵循统一的JSON格式
- **理由**: 标准化元数据格式可以简化处理逻辑，提高系统可维护性
- **执行方式**: 使用JSON Schema验证元数据格式

## 3. 工具函数管理

### 3.1 工具函数整合

- **规则**: 将分散的工具函数整合到集中式工具库，消除重复实现
- **理由**: 审计发现12组功能重复的工具函数，分布在8个不同文件中
- **实施方案**: 创建模块化的工具库，按功能分类组织

### 3.2 工具函数文档化

- **规则**: 所有工具函数必须有JSDoc注释，包括参数、返回值和用例说明
- **理由**: 良好的文档可以减少重复实现，提高代码复用率
- **执行方式**: 使用ESLint规则强制要求JSDoc注释

## 4. 内部链接优化

### 4.1 内部链接增强

- **规则**: 每个内容页面应至少包含5个内部链接
- **理由**: 审计发现内容页面之间的内部链接偏少，平均每页仅有2.4个内部链接
- **执行方式**: 在内容审核流程中检查内部链接数量

### 4.2 相关内容推荐

- **规则**: 每个页面底部应包含"相关内容"部分，推荐3-5个相关页面
- **理由**: 增强内容间的关联性，提高用户浏览深度
- **实施方案**: 基于元数据和关键词分析自动生成相关内容推荐

## 5. 实施计划

1. **短期目标** (1-2个月):
   - 创建元数据访问层
   - 工具函数整合
   - 更新ESLint配置

2. **中期目标** (3-6个月):
   - 完成内部链接优化
   - 实现相关内容推荐功能
   - 重构不符合规范的组件

3. **长期目标** (6个月以上):
   - 建立持续监控机制
   - 开发自动化工具辅助实施和验证改进

## 6. 持续监控

为确保代码质量持续符合规范，我们将建立以下监控机制：

1. 在CI流程中集成代码结构分析
2. 定期运行全面的代码审计
3. 建立代码质量指标仪表板

---

*版本: 1.0.0*  
*最后更新: 2024-04-12*  
*作者: 凿壁团队*
