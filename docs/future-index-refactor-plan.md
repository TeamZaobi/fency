# Index.html 重构计划与技术规范

> **⚠️ 未来规划文档 ⚠️**
>
> 本文档描述了项目的未来发展方向，与当前实施的手动维护模式有所冲突。参考 [项目需求文档](./prd.md) 了解项目整体规划。当前的内容处理工作流程请参考 [内容处理工作流](./content-processing-workflow.md)。

本文档概述了重构 `index.html` 的计划，目标是将其转变为一个动态的内容聚合器。**注意：本计划已更新为完全自动化流程，所有检查、确认、审核、设计、决策和执行工作均由 Cursor/AI 通过编程方式自动完成。**

## 0. 预备阶段：内容迁移与自动化元数据初始化

在开始核心重构工作之前，将自动完成以下准备步骤：

1.  **自动化内容迁移与修正:**
    *   Cursor 将**编写并执行脚本**（例如，使用 Node.js 文件系统 API）来识别 `react-app/` 下的内容页面，并根据预定义的分类规则（或通过分析页面内容推断）将其移动到 `html/pages/` 下的相应子目录。
    *   Cursor 将**利用 HTML 解析库**（如 Cheerio 或 JSDOM）分析每个迁移的 HTML 文件，并**尝试通过编程方式**补充或修正 `<head>` 中的元数据标签（`<title>`, `<meta name="description">`, `<meta name="category">`, `<meta name="publish-date">`, `<meta name="keywords">`）。这可能涉及调用 LLM API 来生成描述或关键词。
    *   Cursor 将**尝试通过 DOM 操作**在页面合适位置（如页脚）自动插入返回首页的链接和作者信息（基于预设模板或对页面结构的分析）。
    *   Cursor 将**尝试通过编程方式**在页面可见内容中添加发布日期和分类标签，以符合 `web-dev.mdc` 规则 D.4 (接受自动化可能失败或效果不佳的风险)。
    *   Cursor 将**运行代码分析和启发式检查**，对自动修改的元数据（特别是描述和关键词）的相关性进行自我评估，并记录任何低置信度或潜在问题的分析结果。
2.  **自动化元数据初始化:**
    *   Cursor 将**自动编写并执行**一个一次性的 Node.js 脚本 (`scripts/generate-initial-metadata.js`)。
    *   该脚本将**使用文件系统 API** 扫描 `html/pages/` 目录，**利用 HTML 解析库**提取每个文件所需的元数据，并通过系统调用获取文件的 `lastModifiedDate`，最终构建并**以原子方式写入**初始的 `html/metadata.json` 文件。
    *   Cursor 将**对生成的脚本执行静态代码分析**（如检查错误处理、未使用的变量、潜在的逻辑问题）。

## 1. 核心目标

*   `index.html` 通过客户端 JavaScript **动态渲染**卡片列表。
*   内容发布流程**完全自动化** `html/metadata.json` 的维护（通过在 `.cursor/rules/web-dev.mdc` 中配置，由 Cursor 在生成新页面后自动调用更新脚本完成）。

## 2. 架构选型 (自动化决策)

*   **渲染模式:** 客户端渲染 (Client-Side Rendering - CSR)。
    *   **自动决策理由:** 与交互式知识图谱的需求天然契合，避免了复杂的服务器端渲染或构建步骤，符合自动化流程的要求。
*   **元数据存储:** 使用 `html/metadata.json` 文件。
    *   **自动决策理由:** 结构简单，易于通过脚本进行读写和版本控制。

## 3. 技术栈 (自动化选择与配置)

*   **HTML:** HTML5
*   **CSS:** Tailwind CSS (通过 CDN 引入，易于自动化集成) 或 自定义 CSS (`html/css/style.css`)
*   **核心脚本语言:** TypeScript (`html/js/main.ts`)，编译为 JavaScript (`html/js/main.js`)。
    *   **自动决策理由:** 提供类型安全，利于自动化代码分析和重构。
*   **构建工具 (编译 TS):** `tsc` (TypeScript 编译器)。
    *   **自动决策理由:** TypeScript 官方工具，集成简单，满足基本编译需求。

## 4. 核心组件与自动化规范

*   **`html/index.html`:**
    *   基础结构由 Cursor **自动生成**，包含必要的元素和空的分类容器。Cursor 将**通过解析生成的 HTML 并检查关键元素 ID** 进行自动验证。
*   **`html/metadata.json`:**
    *   结构由 Cursor **根据 `types.ts` 中的接口定义自动生成**。初始文件由自动化脚本生成。Cursor 将**通过 JSON Schema 或类似机制**自动验证文件格式。
*   **`html/js/main.ts`:**
    *   代码由 Cursor **自动编写**，实现元数据加载、动态卡片渲染、图谱构建与渲染、主题切换等功能。
    *   Cursor 将**自动执行 Linter (如 ESLint)** 进行代码风格和潜在错误检查，并**运行编译命令 (`npm run build`)** 进行类型检查和基础构建验证。
*   **`.cursor/rules/web-dev.mdc`:**
    *   规则由 Cursor **基于项目目标和技术栈自动生成和更新**。规则的有效性通过自动化流程中的测试环节进行验证。
    *   明确包含调用自动化元数据更新脚本的指令。
*   **自动化元数据更新脚本 (`scripts/update-metadata.js`):**
    *   脚本由 Cursor **自动编写**。包含解析 HTML、更新 JSON 和原子写入逻辑。
    *   Cursor 将**执行静态代码分析和基础的功能模拟测试**来验证脚本逻辑，特别是文件写入和错误处理部分。

## 5. 实施路线图 (完全自动化)

0.  **阶段 0: 自动化内容迁移、修正与元数据初始化**
1.  **阶段 1: 自动化基础结构生成与验证**
2.  **阶段 2: 自动化动态卡片渲染逻辑编写与测试**
3.  **阶段 3: 自动化样式与交互实现与测试**
4.  **阶段 4: 自动化元数据更新流程实现与测试**

## 6. 技术风险与缓解 (完全自动化视角)

*   **`metadata.json` 损坏:**
    *   **缓解:** Cursor **自动编写的脚本强制采用原子写入**。**自动实现定期备份**机制。
*   **关键词/元数据质量:**
    *   **缓解:** Cursor **通过优化 LLM prompt 和增加验证逻辑**来提高自动提取/生成的元数据质量。**自动化分析**将标记低置信度项，但接受质量可能不如人工审核。
*   **脚本健壮性:**
    *   **缓解:** Cursor **自动编写**包含详细错误处理和日志记录的脚本。**自动执行静态分析和单元/集成测试**（如果测试框架可用）。
*   **规则 D.4 (可见标签) 符合性:**
    *   **缓解:** 自动化流程将**尽力尝试**添加可见标签，但依赖 `<meta>` 标签作为主要数据源。**自动化检查**将报告符合性，接受可能存在的不符合。
*   **自动化测试覆盖不足:**
    *   **缓解:** **最大化自动化测试**的覆盖范围（单元、集成、基础端到端）。接受视觉和复杂交互问题可能被遗漏。
*   **自动化决策局限:**
    *   **缓解:** 基于预设规则和通用实践进行决策。允许后续手动调整。