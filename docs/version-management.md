# 凿壁项目版本管理计划

## 1. 版本管理概述

凿壁项目采用**功能驱动**的版本管理策略，而非固定时间周期的发布模式。这意味着我们的版本发布由功能完成度和产品路线图驱动，确保每个版本都提供有意义的用户价值，同时保持高质量标准。

### 1.1 核心原则

- **功能驱动**：版本发布基于功能完成度和产品路线图，而非固定时间表
- **质量优先**：版本发布必须满足预定义的质量标准
- **语义化版本**：遵循语义化版本控制规范，清晰传达变更的性质和影响
- **透明沟通**：通过详细的更新日志和版本说明，清晰传达每个版本的变更内容

## 2. 版本号规范

凿壁项目采用语义化版本控制（Semantic Versioning）规范：

- **格式**：`主版本号.次版本号.修订号`（例如：1.2.3）
- **主版本号**：当进行不兼容的API更改或重大功能重构时递增
- **次版本号**：当添加功能但保持向后兼容性时递增
- **修订号**：当进行向后兼容的错误修复时递增
- **预发布版本**：可使用后缀标识，如 `1.0.0-alpha.1`、`1.0.0-beta.2`

## 3. 分支策略

凿壁项目采用 Git Flow 工作流模型，包含以下分支类型：

- **master**：稳定的生产环境代码，只接受来自 release 和 hotfix 分支的合并
- **develop**：开发主分支，包含最新的开发代码
- **feature/***：新功能开发分支，从 develop 分支创建，完成后合并回 develop
- **release/***：发布准备分支，从 develop 分支创建，完成后合并到 master 和 develop
- **hotfix/***：紧急修复分支，从 master 分支创建，完成后合并到 master 和 develop

### 3.1 分支命名规范

- **feature分支**：`feature/功能名称`（例如：`feature/user-authentication`）
- **release分支**：`release/版本号`（例如：`release/1.2.0`）
- **hotfix分支**：`hotfix/版本号`（例如：`hotfix/1.2.1`）

## 4. 版本类型

根据功能重要性和范围，将版本分为以下类型：

### 4.1 主要版本（Major Release）

- 包含重大功能更新或架构变更
- 可能包含不向后兼容的API变更
- 通常需要用户进行迁移或适应新功能
- 例如：从1.x升级到2.0

### 4.2 功能版本（Feature Release）

- 包含新功能但保持向后兼容性
- 通常对应次版本号的增加
- 例如：从1.1升级到1.2

### 4.3 维护版本（Maintenance Release）

- 主要包含错误修复和小改进
- 完全向后兼容
- 对应修订号的增加
- 例如：从1.2.0升级到1.2.1

### 4.4 紧急修复版本（Hotfix）

- 针对生产环境中的关键问题
- 最小范围的变更，专注于特定问题
- 快速发布流程
- 例如：从1.2.1升级到1.2.2

## 5. 版本规划与路线图

### 5.1 产品路线图

凿壁项目维护一个清晰的产品路线图，包含计划中的功能和改进。路线图由产品负责人维护，并定期与团队和利益相关者共享。

路线图包含以下内容：
- 计划功能和改进
- 预计版本分配
- 优先级和依赖关系
- 大致时间框架（基于功能复杂度和资源可用性）

### 5.2 版本范围定义

每个版本都有明确定义的功能范围（Feature Set），由产品负责人和技术负责人共同确定。一旦版本范围确定，避免中途添加新功能（除非通过变更管理流程批准）。

### 5.3 里程碑设置

为每个版本设置关键里程碑：
- **功能冻结（Feature Freeze）**：停止添加新功能
- **代码冻结（Code Freeze）**：只允许修复错误
- **发布候选（Release Candidate）**：最终测试阶段
- **正式发布（General Availability）**：向用户发布

## 6. 发布流程

### 6.1 发布决策标准

版本发布基于以下标准，而非固定时间表：

1. **功能完成度**
   - 计划功能已完成开发
   - 所有功能通过验收测试
   - 文档已更新

2. **质量门槛**
   - 所有自动化测试通过
   - 代码审查完成
   - 关键性能指标达标
   - 无阻塞性错误
   - 安全审查通过

3. **用户价值评估**
   - 版本包含足够的用户价值以证明发布合理
   - 新功能解决了重要的用户需求
   - 改进了用户体验或系统性能

### 6.2 发布流程步骤

1. **发布准备**
   - 当计划功能完成并通过初步测试后，从 develop 分支创建 release 分支
   - 在 release 分支上进行最终测试和修复
   - 更新版本号和更新日志（CHANGELOG.md）

2. **发布审核**
   - 功能验收：确认所有计划功能已完成并符合要求
   - 质量验证：确认所有测试通过，无阻塞性问题
   - 文档审查：确认用户文档和技术文档已更新
   - 发布决策：由产品负责人和技术负责人共同决定是否发布

3. **正式发布**
   - 将 release 分支合并到 master 分支
   - 在 master 分支上创建版本标签
   - 将 release 分支合并回 develop 分支
   - 删除 release 分支

4. **发布后活动**
   - 部署到生产环境
   - 发布公告和更新说明
   - 监控新版本表现
   - 收集用户反馈

### 6.3 热修复流程

1. 从 master 分支创建 hotfix 分支
2. 在 hotfix 分支上修复问题
3. 更新版本号和更新日志
4. 将 hotfix 分支合并到 master 和 develop 分支
5. 在 master 分支上创建版本标签
6. 删除 hotfix 分支

## 7. 版本文档管理

### 7.1 更新日志（CHANGELOG.md）

- 每个版本都应更新CHANGELOG.md
- 按版本号降序排列
- 每个版本包含以下分类：
  - Added（新增功能）
  - Changed（功能变更）
  - Deprecated（即将移除的功能）
  - Removed（已移除的功能）
  - Fixed（错误修复）
  - Security（安全相关修复）

### 7.2 版本说明模板

```markdown
# 版本 X.Y.Z (YYYY-MM-DD)

## 新增功能
- 功能A的详细描述 (#PR号)
- 功能B的详细描述 (#PR号)

## 功能变更
- 变更A的详细描述 (#PR号)
- 变更B的详细描述 (#PR号)

## 错误修复
- 修复A的详细描述 (#PR号)
- 修复B的详细描述 (#PR号)

## 性能改进
- 改进A的详细描述 (#PR号)
- 改进B的详细描述 (#PR号)

## 依赖更新
- 更新库A从x.y.z到a.b.c
- 更新库B从x.y.z到a.b.c
```

## 8. 提交消息规范

采用 Conventional Commits 规范：

```
<类型>[可选作用域]: <描述>

[可选正文]

[可选脚注]
```

类型包括：
- **feat**: 新功能
- **fix**: 错误修复
- **docs**: 文档更改
- **style**: 不影响代码含义的更改（空格、格式等）
- **refactor**: 既不修复错误也不添加功能的代码更改
- **perf**: 提高性能的代码更改
- **test**: 添加或修正测试
- **build**: 影响构建系统或外部依赖的更改
- **ci**: 对CI配置文件和脚本的更改
- **chore**: 其他不修改src或test文件的更改

## 9. 版本支持策略

### 9.1 版本支持政策

明确定义每种版本类型的支持期限：

- **主要版本（Major Release）**：支持至少12个月或直到下两个主要版本发布
- **功能版本（Feature Release）**：支持至少6个月或直到下两个功能版本发布
- **维护版本（Maintenance Release）**：通常不单独支持，跟随其所属的功能版本

### 9.2 版本生命周期阶段

为每个版本定义明确的生命周期阶段：

1. **活跃开发**：接收新功能和错误修复
2. **维护模式**：只接收错误修复和安全更新
3. **安全维护**：只接收关键安全更新
4. **生命周期结束（EOL）**：不再接收任何更新

## 10. 版本管理责任分配

- **产品负责人**：负责确定版本内容和优先级
- **技术负责人**：负责审核合并请求和最终发布
- **开发团队**：遵循分支策略和提交规范
- **QA团队**：负责版本测试和验证
- **DevOps团队**：负责自动化部署和环境管理

## 11. 相关文档

- [CHANGELOG.md](../CHANGELOG.md) - 详细的变更日志
- [CONTRIBUTING.md](../CONTRIBUTING.md) - 包含分支策略和提交规范的贡献指南

---

*版本: 1.0.0*  
*最后更新: 2023-11-15*  
*作者: 凿壁团队*
